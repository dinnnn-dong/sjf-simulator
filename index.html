<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SJF Simulator - anak luchu (Detailed Gantt & Explanations)</title>
<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: "Orbitron", sans-serif;
  background: radial-gradient(circle at center, #0a192f 0%, #000 100%);
  color: #e0f7fa;
  overflow-x: hidden;
  min-height: 100vh;
}

/* Background */
canvas#bg {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 0;
  width: 100%;
  height: 100%;
}

/* Header */
header {
  text-align: center;
  padding: 40px 10px;
  color: #80dfff;
  text-shadow: 0 0 15px #00bfff;
  animation: fadeDown 1.2s ease;
}
header h1 {
  margin: 0;
  font-size: 32px;
  letter-spacing: 2px;
}
header p {
  font-size: 14px;
  color: #b3e5fc;
}

/* Container */
.container {
  position: relative;
  z-index: 2;
  max-width: 950px;
  margin: 0 auto;
  padding: 25px;
  background: rgba(20, 40, 70, 0.6);
  border-radius: 16px;
  border: 1px solid rgba(0,191,255,0.3);
  box-shadow: 0 0 25px rgba(0,191,255,0.3);
  backdrop-filter: blur(10px);
  animation: fadeUp 1.5s ease;
}

/* Input  */
input, select {
  width: 100%;
  background: transparent;
  border: 1px solid #00bcd4;
  border-radius: 8px;
  color: #b3e5fc;
  padding: 8px;
  font-size: 14px;
  outline: none;
  transition: all 0.3s;
}
input:focus, select:focus {
  box-shadow: 0 0 10px #00e5ff;
  border-color: #00e5ff;
}

/* Buttons */
button {
  background: linear-gradient(90deg, #00e5ff, #00bcd4);
  color: #001f3f;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s;
}
button:hover {
  background: linear-gradient(90deg, #00bcd4, #2196f3);
  color: #e0f7fa;
  transform: scale(1.05);
  box-shadow: 0 0 20px #00bcd4;
}
button.primary {
  background: linear-gradient(90deg, #2196f3, #00bcd4);
  color: white;
}

/* Rows */
.row { display: flex; flex-wrap: wrap; gap: 10px; }
.col { flex: 1; min-width: 150px; }

/* Tip */
.tip {
  font-size: 14px;
  color: #b3e5fc;
  text-align: center;
  margin-bottom: 20px;
  text-shadow: 0 0 8px #00bcd4;
}

/* Output */
.summary {
  text-align: center;
  margin-top: 15px;
  font-weight: bold;
  color: #80d8ff;
  text-shadow: 0 0 10px #00bcd4;
}
.gantt {
  display: flex;
  overflow-x: auto;
  margin-top: 20px;
  padding: 12px;
  gap: 8px;
  justify-content: center;
}
.gseg {
  background: linear-gradient(135deg, #00e5ff, #0091ea);
  color: #001f3f;
  padding: 10px;
  border-radius: 8px;
  min-width: 70px;
  text-align: center;
  font-weight: bold;
  box-shadow: 0 0 20px #00bcd4;
  animation: grow 0.8s ease forwards;
  opacity: 0;
}

/* Table */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  font-size: 14px;
  color: #b3e5fc;
  text-align: center;
  animation: fadeUp 1s ease;
}
th {
  background: #00bcd4;
  color: #001f3f;
  padding: 8px;
}
td {
  border: 1px solid rgba(0,191,255,0.3);
  padding: 8px;
}

/* Explanation box */
.explanation {
  margin-top: 25px;
  background: rgba(0,191,255,0.06);
  border-left: 4px solid #00e5ff;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,191,255,0.12);
  animation: fadeUp 1.5s ease;
}
.explanation h3 {
  color: #00e5ff;
  margin-top: 0;
}
.explanation p {
  font-size: 14px;
  color: #b3e5fc;
  line-height: 1.5;
}

/*Gantt*/
.ganttDetailed {
  margin-top: 18px;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 0 10px rgba(0,191,255,0.08);
}
.timeline {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0;
  height: 58px;
  margin-bottom: 6px;
  overflow-x: auto;
}
.segment {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  padding: 8px 10px;
  border-radius: 4px;
  font-weight: bold;
  background: linear-gradient(90deg,#e0f7fa,#b3e5fc);
  color: #001f3f;
  border: 1px solid rgba(0,191,255,0.18);
  box-shadow: 0 0 8px rgba(0,191,255,0.06);
  white-space: nowrap;
}
.timelineTicks {
  display: flex;
  justify-content: flex-start;
  gap: 0;
  margin-top: 6px;
  font-size: 12px;
  color: #b3e5fc;
}
.tick {
  min-width: 40px;
  text-align: center;
  border-left: 1px dashed rgba(0,191,255,0.15);
  padding-left: 6px;
}


.figcap {
  text-align: center;
  font-size: 13px;
  color: #b3e5fc;
  margin-top: 6px;
}


@keyframes fadeUp { from { opacity: 0; transform: translateY(20px);} to {opacity:1; transform: translateY(0);} }
@keyframes fadeDown { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
@keyframes grow { to {opacity: 1; transform: scale(1);} }
</style>
</head>
<body>
<canvas id="bg"></canvas>

<header>
  <h1>SJF Interactive Simulator</h1>
  <p>Visualisasi SJF dengan Mode Input Bebas </p>
</header>

<div class="container">
  <div class="tip">Masukkan data proses kamu di bawah ini, trus tinggal klik <b>Jalankan Simulasi</b>.</div>

  <div class="input-section">
    <div class="row">
      <div class="col"><label>ID Proses</label><input id="procId" placeholder="P1"></div>
      <div class="col"><label>Arrival Time</label><input id="arrival" type="number" placeholder="0"></div>
      <div class="col"><label>Burst Time</label><input id="burst" type="number" placeholder="1"></div>
      <div class="col"><label>Mode</label>
        <select id="mode">
          <option value="pre">Preemptive (SRTF)</option>
          <option value="non">Non-Preemptive</option>
        </select>
      </div>
    </div>
    <div style="text-align:center; margin-top:15px;">
      <button id="addProc">Tambahin Proses</button>
      <button id="clearProcs">Hapus Semuah</button>
      <button id="run" class="primary">Jalankan Simulasi</button>
    </div>
    <p id="procList" style="text-align:center; margin-top:12px;">Belum ada proses nichh</p>
  </div>

  <div id="output" style="display:none;">
    <div class="summary" id="summary"></div>
    <!-- This simple gantt (small segments) is kept for animation, but the detailed timeline below is the main one -->
    <div class="gantt" id="gantt"></div>

    <div id="tableWrap"></div>

    
    <div id="ganttDetailedWrap" class="ganttDetailed" style="display:none;">
      <div id="timeline" class="timeline"></div>
      <div id="timelineTicks" class="timelineTicks"></div>
      <div class="figcap">Figure 4.2: Gantt chart SJF</div>
    </div>

    <div id="explanation" class="explanation"></div>
  </div>
</div>

<script>

const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
let particles = [];
for (let i = 0; i < 80; i++) {
  particles.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 2,
    dx: (Math.random() - 0.5) * 0.5,
    dy: (Math.random() - 0.5) * 0.5
  });
}
function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#00bcd4";
  particles.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
    ctx.fill();
    p.x += p.dx;
    p.y += p.dy;
    if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
    if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
  });
  requestAnimationFrame(animate);
}
animate();

let customProcs = [];
function sjfNonPreemptive(procs) {
  let proses = JSON.parse(JSON.stringify(procs)).map(p => ({
    id: p.id,
    arrival: +p.arrival,
    burst: +p.burst
  }));

  proses.sort((a, b) => a.arrival - b.arrival || a.burst - b.burst);

  let waktuSekarang = 0;
  let selesai = [];
  let jadwal = [];
  let tabel = [];

  while (selesai.length < proses.length) {
    // Ambil proses yang sudah datang
    let ready = proses.filter(p => !selesai.includes(p) && p.arrival <= waktuSekarang);
    if (!ready.length) {
      waktuSekarang = proses.find(p => !selesai.includes(p)).arrival;
      continue;
    }
    
    ready.sort((a, b) => a.burst - b.burst);
    let p = ready[0];
    let mulai = waktuSekarang;
    let selesaiWaktu = mulai + p.burst;

    jadwal.push({ id: p.id, start: mulai, end: selesaiWaktu });
    tabel.push({
      id: p.id,
      arrival: p.arrival,
      burst: p.burst,
      start: mulai,
      completion: selesaiWaktu,
      waiting: mulai - p.arrival,
      turnaround: selesaiWaktu - p.arrival
    });

    selesai.push(p);
    waktuSekarang = selesaiWaktu;
  }

  let avgWT = tabel.reduce((a, b) => a + b.waiting, 0) / tabel.length;
  let avgTAT = tabel.reduce((a, b) => a + b.turnaround, 0) / tabel.length;

  return { schedule: jadwal, table: tabel, avgWT, avgTAT };
}


function sjfPreemptive(procs) {
  let proses = JSON.parse(JSON.stringify(procs)).map(p => ({
    id: p.id,
    arrival: +p.arrival,
    burst: +p.burst,
    remaining: +p.burst
  }));

  let jadwal = [];
  let selesai = [];
  let waktu = 0;

  while (selesai.length < proses.length) {
    let ready = proses.filter(p => p.arrival <= waktu && p.remaining > 0);
    if (ready.length === 0) {
      waktu++;
      continue;
    }
    ready.sort((a, b) => a.remaining - b.remaining);
    let p = ready[0];

    let last = jadwal[jadwal.length - 1];
    if (!last || last.id !== p.id) {
      jadwal.push({ id: p.id, start: waktu, end: waktu + 1 });
    } else {
      last.end++;
    }

    p.remaining--;
    if (p.remaining === 0) selesai.push(p);
    waktu++;
  }

  let tabel = proses.map(p => {
    let firstStart = jadwal.find(j => j.id === p.id).start;
    let lastEnd = jadwal.filter(j => j.id === p.id).at(-1).end;
    return {
      id: p.id,
      arrival: p.arrival,
      burst: p.burst,
      start: firstStart,
      completion: lastEnd,
      waiting: lastEnd - p.arrival - p.burst,
      turnaround: lastEnd - p.arrival
    };
  });

  let avgWT = tabel.reduce((a, b) => a + b.waiting, 0) / tabel.length;
  let avgTAT = tabel.reduce((a, b) => a + b.turnaround, 0) / tabel.length;

  return { schedule: jadwal, table: tabel, avgWT, avgTAT };
}



function refreshList() {
  const list = document.getElementById("procList");
  list.innerHTML = customProcs.length
    ? customProcs.map(p => `${p.id} (AT=${p.arrival}, BT=${p.burst}, ${p.mode})`).join("<br>")
    : "Belum ada proses.";
}

document.getElementById("addProc").onclick = () => {
  const id = document.getElementById("procId").value || `P${customProcs.length + 1}`;
  const arrival = +document.getElementById("arrival").value || 0;
  const burst = +document.getElementById("burst").value || 1;
  const mode = document.getElementById("mode").value;
  customProcs.push({ id, arrival, burst, mode });
  refreshList();
};

document.getElementById("clearProcs").onclick = () => {
  customProcs = [];
  refreshList();
};

document.getElementById("run").onclick = () => {
  if (!customProcs.length) {
    alert("Masukkan minimal 1 proses!");
    return;
  }
  const hasPre = customProcs.some(p => p.mode === "pre");
  const mode = hasPre ? "pre" : "non";
  const hasil = mode === "pre" ? sjfPreemptive(customProcs) : sjfNonPreemptive(customProcs);
  renderOutput(hasil, mode === "pre" ? "Preemptive (SRTF)" : "Non-Preemptive");
};


function renderOutput(res, modeText) {
  document.getElementById("output").style.display = "block";

  
  document.getElementById("summary").innerHTML = `
    <b>Mode: ${modeText}</b><br>
    Rata-rata Waiting Time: <b>${res.avgWT.toFixed(2)}</b> |
    Rata-rata Turnaround Time: <b>${res.avgTAT.toFixed(2)}</b>
  `;

  
  let tableHTML = `
    <table>
      <tr><th>ID</th><th>Arrival</th><th>Burst</th><th>Start</th>
      <th>Completion</th><th>Waiting</th><th>Turnaround</th></tr>
  `;
  res.table.forEach(p => {
    tableHTML += `<tr>
      <td>${p.id}</td><td>${p.arrival}</td><td>${p.burst}</td>
      <td>${p.start}</td><td>${p.completion}</td>
      <td>${p.waiting}</td><td>${p.turnaround}</td>
    </tr>`;
  });
  tableHTML += "</table>";
  document.getElementById("tableWrap").innerHTML = tableHTML;

  
  let ganttHTML = `<div class="gantt" style="flex-direction: column; align-items:center;">`;
  ganttHTML += `<div style="display:flex;">`;
  res.schedule.forEach(s => {
    ganttHTML += `
      <div class="gseg" style="min-width:${(s.end - s.start) * 25}px;">
        ${s.id}
      </div>`;
  });
  ganttHTML += `</div><div style="display:flex;">`;
  res.schedule.forEach(s => {
    ganttHTML += `<div style="min-width:${(s.end - s.start) * 25}px;text-align:left;font-size:12px;">${s.start}</div>`;
  });
  ganttHTML += `<div style="font-size:12px;">${res.schedule.at(-1).end}</div>`;
  ganttHTML += `</div></div>`;
  document.getElementById("gantt").innerHTML = ganttHTML;

  
  const p0 = res.table[0];
  document.getElementById("explanation").innerHTML = `
    <h3>Penjelasan Perhitungan Algoritma SJF (${modeText})</h3>
    <p>Proses dieksekusi berdasarkan waktu burst terkecil yang telah tiba pada CPU. Jika ada proses baru yang datang dengan waktu eksekusi lebih pendek (khusus mode preemptive), maka CPU berpindah ke proses tersebut.</p>
    <p><b>Rumus yang digunakan:</b></p>
    <ul>
      <li><b>Completion Time (CT)</b> = Waktu saat proses selesai dijalankan</li>
      <li><b>Turnaround Time (TAT)</b> = CT - Arrival Time</li>
      <li><b>Waiting Time (WT)</b> = TAT - Burst Time</li>
    </ul>
    <p>Contoh perhitungan untuk <b>${p0.id}</b>:</p>
    <ul>
      <li>Arrival Time = ${p0.arrival}</li>
      <li>Burst Time = ${p0.burst}</li>
      <li>Completion Time = ${p0.completion}</li>
      <li>Turnaround Time = ${p0.completion} - ${p0.arrival} = <b>${p0.turnaround}</b></li>
      <li>Waiting Time = ${p0.turnaround} - ${p0.burst} = <b>${p0.waiting}</b></li>
    </ul>
    <p>Artinya, proses <b>${p0.id}</b> menunggu CPU selama <b>${p0.waiting}</b> satuan waktu sebelum dijalankan, dan membutuhkan total waktu <b>${p0.turnaround}</b> untuk selesai sepenuhnya.</p>
  `;
}
</script>
