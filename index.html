<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SJF Simulator - anak luchu</title>
<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: "Orbitron", sans-serif;
  background: radial-gradient(circle at center, #0a192f 0%, #000 100%);
  color: #e0f7fa;
  overflow-x: hidden;
  min-height: 100vh;
}

/* Background Particles */
canvas#bg {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 0;
  width: 100%;
  height: 100%;
}

/* Header */
header {
  text-align: center;
  padding: 40px 10px;
  color: #80dfff;
  text-shadow: 0 0 15px #00bfff;
  animation: fadeDown 1.2s ease;
}
header h1 {
  margin: 0;
  font-size: 32px;
  letter-spacing: 2px;
}
header p {
  font-size: 14px;
  color: #b3e5fc;
}

/* Container */
.container {
  position: relative;
  z-index: 2;
  max-width: 950px;
  margin: 0 auto;
  padding: 25px;
  background: rgba(20, 40, 70, 0.6);
  border-radius: 16px;
  border: 1px solid rgba(0,191,255,0.3);
  box-shadow: 0 0 25px rgba(0,191,255,0.3);
  backdrop-filter: blur(10px);
  animation: fadeUp 1.5s ease;
}

/* Neon Input Fields */
input, select {
  width: 100%;
  background: transparent;
  border: 1px solid #00bcd4;
  border-radius: 8px;
  color: #b3e5fc;
  padding: 8px;
  font-size: 14px;
  outline: none;
  transition: all 0.3s;
}
input:focus, select:focus {
  box-shadow: 0 0 10px #00e5ff;
  border-color: #00e5ff;
}

/* Buttons */
button {
  background: linear-gradient(90deg, #00e5ff, #00bcd4);
  color: #001f3f;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s;
}
button:hover {
  background: linear-gradient(90deg, #00bcd4, #2196f3);
  color: #e0f7fa;
  transform: scale(1.05);
  box-shadow: 0 0 20px #00bcd4;
}
button.primary {
  background: linear-gradient(90deg, #2196f3, #00bcd4);
  color: white;
}

/* Rows */
.row { display: flex; flex-wrap: wrap; gap: 10px; }
.col { flex: 1; min-width: 150px; }

/* Tip */
.tip {
  font-size: 14px;
  color: #b3e5fc;
  text-align: center;
  margin-bottom: 20px;
  text-shadow: 0 0 8px #00bcd4;
}

/* Output */
.summary {
  text-align: center;
  margin-top: 15px;
  font-weight: bold;
  color: #80d8ff;
  text-shadow: 0 0 10px #00bcd4;
}
.gantt {
  display: flex;
  overflow-x: auto;
  margin-top: 20px;
  padding: 12px;
  gap: 8px;
  justify-content: center;
}
.gseg {
  background: linear-gradient(135deg, #00e5ff, #0091ea);
  color: #001f3f;
  padding: 10px;
  border-radius: 8px;
  min-width: 70px;
  text-align: center;
  font-weight: bold;
  box-shadow: 0 0 20px #00bcd4;
  animation: grow 0.8s ease forwards;
  opacity: 0;
}

/* Table */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  font-size: 14px;
  color: #b3e5fc;
  text-align: center;
  animation: fadeUp 1s ease;
}
th {
  background: #00bcd4;
  color: #001f3f;
  padding: 8px;
}
td {
  border: 1px solid rgba(0,191,255,0.3);
  padding: 8px;
}

/* Explanation box */
.explanation {
  margin-top: 25px;
  background: rgba(0,191,255,0.1);
  border-left: 4px solid #00e5ff;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,191,255,0.2);
  animation: fadeUp 1.5s ease;
}
.explanation h3 {
  color: #00e5ff;
  margin-top: 0;
}
.explanation p {
  font-size: 14px;
  color: #b3e5fc;
}

/* Animations */
@keyframes fadeUp { from { opacity: 0; transform: translateY(20px);} to {opacity:1; transform: translateY(0);} }
@keyframes fadeDown { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
@keyframes grow { to {opacity: 1; transform: scale(1);} }
</style>
</head>
<body>
<canvas id="bg"></canvas>

<header>
  <h1>SJF Interactive Simulator</h1>
  <p>Visualisasi sjf dengan Mode Input Bebas</p>
</header>

<div class="container">
  <div class="tip">Masukkan data proses kamu di bawah ini, trus tinggal klik <b>Jalankan Simulasi</b>.</div>

  <div class="input-section">
    <div class="row">
      <div class="col"><label>ID Proses</label><input id="procId" placeholder="P1"></div>
      <div class="col"><label>Arrival Time</label><input id="arrival" type="number" placeholder="0"></div>
      <div class="col"><label>Burst Time</label><input id="burst" type="number" placeholder="1"></div>
      <div class="col"><label>Mode</label>
        <select id="mode">
          <option value="pre">Preemptive (SRTF)</option>
          <option value="non">Non-Preemptive</option>
        </select>
      </div>
    </div>
    <div style="text-align:center; margin-top:15px;">
      <button id="addProc">Tambahin Proses</button>
      <button id="clearProcs">Hapus Semuah</button>
      <button id="run" class="primary">Jalankan Simulasi</button>
    </div>
    <p id="procList" style="text-align:center; margin-top:12px;">Belum ada proses nichh</p>
  </div>

  <div id="output" style="display:none;">
    <div class="summary" id="summary"></div>
    <div class="gantt" id="gantt"></div>
    <div id="tableWrap"></div>
    <div id="explanation" class="explanation"></div>
  </div>
</div>

<script>
// Particles Background
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;
let particles = [];
for(let i=0;i<80;i++) particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2,dx:(Math.random()-0.5)*0.5,dy:(Math.random()-0.5)*0.5});
function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#00bcd4";
  particles.forEach(p=>{
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
    p.x+=p.dx; p.y+=p.dy;
    if(p.x<0||p.x>canvas.width)p.dx*=-1;
    if(p.y<0||p.y>canvas.height)p.dy*=-1;
  });
  requestAnimationFrame(animate);
}
animate();

// Core Logic
function clone(a){return JSON.parse(JSON.stringify(a))}

function sjfNonPreemptive(procs){
  procs=clone(procs).map(p=>({...p,arrival:+p.arrival,burst:+p.burst}));
  procs.sort((a,b)=>a.arrival-b.arrival||a.burst-b.burst);
  let time=0;const done=[];const sched=[];const table=[];
  while(done.length<procs.length){
    const ready=procs.filter(p=>!done.includes(p)&&p.arrival<=time);
    if(!ready.length){time=procs.find(p=>!done.includes(p)).arrival;continue;}
    ready.sort((a,b)=>a.burst-b.burst);
    const p=ready[0];const start=time;const end=start+p.burst;
    sched.push({id:p.id,start,end});
    table.push({id:p.id,arrival:p.arrival,burst:p.burst,start,completion:end,waiting:start-p.arrival,turnaround:end-p.arrival});
    done.push(p);
    time=end;
  }
  const avgWT=table.reduce((a,b)=>a+b.waiting,0)/table.length;
  const avgTAT=table.reduce((a,b)=>a+b.turnaround,0)/table.length;
  return {schedule:sched,table,avgWT,avgTAT};
}

function sjfPreemptive(procs){
  procs=clone(procs).map(p=>({...p,arrival:+p.arrival,burst:+p.burst,rem:+p.burst}));
  const sched=[],done=[];let time=0;
  while(done.length<procs.length){
    const ready=procs.filter(p=>!done.includes(p)&&p.arrival<=time&&p.rem>0);
    if(!ready.length){time=procs.find(p=>!done.includes(p)).arrival;continue;}
    ready.sort((a,b)=>a.rem-b.rem);
    const p=ready[0];
    const last=sched[sched.length-1];
    if(!last||last.id!==p.id)sched.push({id:p.id,start:time,end:time+1});
    else last.end++;
    p.rem--;time++;
    if(p.rem===0)done.push(p);
  }
  const table=procs.map(p=>{
    const first=sched.find(s=>s.id===p.id).start;
    const last=sched.filter(s=>s.id===p.id).at(-1).end;
    return {id:p.id,arrival:p.arrival,burst:p.burst,start:first,completion:last,waiting:last-p.arrival-p.burst,turnaround:last-p.arrival};
  });
  const avgWT=table.reduce((a,b)=>a+b.waiting,0)/table.length;
  const avgTAT=table.reduce((a,b)=>a+b.turnaround,0)/table.length;
  return {schedule:sched,table,avgWT,avgTAT};
}

// UI
let customProcs=[];
function refreshList(){
  document.getElementById("procList").innerHTML=customProcs.length?
  customProcs.map(p=>`${p.id} (AT=${p.arrival}, BT=${p.burst}, ${p.mode})`).join("<br>"):"Belum ada proses.";
}

document.getElementById("addProc").onclick=()=>{
  const id=document.getElementById("procId").value||`P${customProcs.length+1}`;
  const arrival=+document.getElementById("arrival").value||0;
  const burst=+document.getElementById("burst").value||1;
  const mode=document.getElementById("mode").value;
  customProcs.push({id,arrival,burst,mode});
  refreshList();
};
document.getElementById("clearProcs").onclick=()=>{customProcs=[];refreshList();};
document.getElementById("run").onclick=()=>{
  if(!customProcs.length){alert("Masukkan minimal 1 proses!");return;}
  const hasPre=customProcs.some(p=>p.mode==="pre");
  const mode=hasPre?"pre":"non";
  const res=mode==="pre"?sjfPreemptive(customProcs):sjfNonPreemptive(customProcs);
  renderOutput(res,"Mode: "+(mode==="pre"?"Preemptive (SRTF)":"Non-Preemptive"));
};

function renderOutput(res,title){
  document.getElementById("output").style.display="block";
  document.getElementById("summary").innerHTML=`<b>${title}</b><br>Avg Waiting Time: <b>${res.avgWT.toFixed(2)}</b> | Avg Turnaround: <b>${res.avgTAT.toFixed(2)}</b>`;
  const gantt=document.getElementById("gantt");
  gantt.innerHTML="";
  res.schedule.forEach((s,i)=>{
    const d=document.createElement("div");
    d.className="gseg";
    d.style.animationDelay=`${i*0.15}s`;
    d.innerHTML=`${s.id}<br><small>${s.start}-${s.end}</small>`;
    gantt.appendChild(d);
  });
  let t=`<table><tr><th>ID</th><th>Arrival</th><th>Burst</th><th>Start</th><th>Completion</th><th>Waiting</th><th>Turnaround</th></tr>`;
  res.table.forEach(x=>t+=`<tr><td>${x.id}</td><td>${x.arrival}</td><td>${x.burst}</td><td>${x.start}</td><td>${x.completion}</td><td>${x.waiting}</td><td>${x.turnaround}</td></tr>`);
  t+="</table>";
  document.getElementById("tableWrap").innerHTML=t;

  // Generate Explanation Text
  const explain = `
  <h3>Jadi Kan wee, gini laa dia Penjelasan Hasil Perhitungannya</h3>
  <p>Simulasi menggunakan <b>${title}</b>.</p>
  <p><b>Rumus-rumus utama:</b></p>
  <ul>
    <li><b>Completion Time (CT)</b> = waktu saat proses selesai dijalankan.</li>
    <li><b>Turnaround Time (TAT)</b> = CT - Arrival Time (AT)</li>
    <li><b>Waiting Time (WT)</b> = TAT - Burst Time (BT)</li>
  </ul>
  <p>Jadi kan wee, tiap baris pada tabel di atas nunjukin waktu mulai (Start), waktu selesai (Completion), serta perhitungan TAT dan WT untuk masing-masing proses.</p>
  <p><b>Contoh:</b><br>
  Misalkan proses pertama (${res.table[0].id}) memiliki Arrival Time = ${res.table[0].arrival}, Burst Time = ${res.table[0].burst}, dan Completion Time = ${res.table[0].completion}.<br>
  Maka:<br>
  TAT = ${res.table[0].completion} - ${res.table[0].arrival} = <b>${res.table[0].turnaround}</b><br>
  WT = ${res.table[0].turnaround} - ${res.table[0].burst} = <b>${res.table[0].waiting}</b>
  </p>
  <p>Artinya, proses tersebut menunggu CPU selama <b>${res.table[0].waiting}</b> satuan waktu sebelum dieksekusi, dan selesai total dalam <b>${res.table[0].turnaround}</b> satuan waktu.</p>
  `;
  document.getElementById("explanation").innerHTML = explain;
}
</script>
</body>
</html>
